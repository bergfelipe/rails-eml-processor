<div class="container mt-4">

  <!-- TÍTULO -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold d-flex align-items-center">
      <i class="fa-solid fa-folder-open text-primary me-2"></i>
      Arquivos
    </h2>

    <%= link_to new_arquivos_email_path, class: "btn btn-outline-primary btn-sm d-flex align-items-center" do %>
      <i class="fa-solid fa-file-circle-plus me-2"></i> Novo Arquivo
    <% end %>
  </div>

  <!-- CARD -->
  <div class="card shadow-sm p-3" style="border-radius: 14px;">

    <table class="table table-hover align-middle" style="border-radius: 14px; overflow:hidden;">
      <thead class="table-light">
        <tr>
          <th style="width: 40%">Arquivo</th>
          <th style="width: 20%">Processado</th>
          <th style="width: 40%" class="text-end">Ações</th>
        </tr>
      </thead>

      <tbody>
        <% if @arquivos_email.blank? %>
          <tr>
            <td colspan="3" class="text-center text-muted py-4">
              Nenhum arquivo enviado ainda.
            </td>
          </tr>
        <% else %>
          <% @arquivos_email.each do |arq| %>
            <tr>
              <td>
                <% if arq.arquivo_email.attached? %>
                  <%= link_to arq.arquivo_email.filename.to_s, url_for(arq.arquivo_email), class: "fw-semibold text-decoration-none" %>
                <% else %>
                  <span class="text-muted">Sem arquivo</span>
                <% end %>
              </td>

              <td>
                <% if arq.processado %>
                  <span class="badge bg-success">
                    <i class="fa-solid fa-check me-1"></i> Sim
                  </span>
                <% else %>
                  <span class="badge bg-secondary">
                    <i class="fa-solid fa-xmark me-1"></i> Não
                  </span>
                <% end %>
              </td>

              <td class="text-end">

                <div class="d-inline-flex gap-1">
              
                  <!-- VER -->
                  <%= link_to arquivos_email_path(arq),
                      class: "btn btn-outline-info btn-sm px-2 py-1" do %>
                    <i class="fa-solid fa-eye"></i>
                  <% end %>
              
                  <!-- REPROCESSAR -->
                  <%= button_to arquivos_emails_path,
                  method: :post,
                  params: { arquivo_email: { arquivo_id: arq.id } },
                  class: "btn-reprocessar btn btn-outline-warning btn-sm px-2 py-1",
                  form: { class: "form-reprocessar " } do %>
            
              <i class="fa-solid fa-rotate-right"></i>
            
            <% end %>
            
              
                </div>
              
              </td>
              
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>

  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".form-reprocessar").forEach(form => {
      form.addEventListener("submit", function (event) {
        if (!confirm("Deseja reprocessar este arquivo?")) {
          event.preventDefault();
        }
      });
    });
  });
  </script>