<div class="container mt-4">

<div class="mb-4 ps-5 position-relative">

  <!-- Botão Voltar -->
  <%= link_to request.referer || cliente_path,
              class: "position-absolute top-50 translate-middle-y start-0 text-dark" do %>
    <i class="fa-solid fa-arrow-left fs-4"></i>
  <% end %>

  <h2 class="fw-bold d-flex align-items-center">
    <i class="fa-solid fa-user text-primary me-2 ms-4"></i>
    <%= @cliente.nome %>
  </h2>

  <p class="text-muted mb-0 ms-4">Detalhes completos do cliente</p>
</div>

  <div class="row">
    <!-- CARD DADOS DO CLIENTE -->
    <div class="col-md-4">
      <div class="card shadow-sm p-3" style="border-radius: 14px;">
        <h4 class="fw-semibold mb-3 d-flex align-items-center">
          <i class="fa-solid fa-id-card me-2 text-primary"></i>
          Informações
        </h4>

        <p><strong>ID:</strong> <%= @cliente.id %></p>
        <p><strong>Email:</strong> <%= @cliente.email %></p>
        <p><strong>Telefone:</strong> <%= @cliente.telefone %></p>

        <hr>

        <p class="text-muted mb-0">Criado em: <%= l @cliente.created_at, format: :short %></p>
      </div>
    </div>

    <!-- CARD PROCESSAMENTOS RELACIONADOS -->
    <div class="col-md-8">
      <div class="card shadow-sm p-3" style="border-radius: 14px;">
        <h4 class="fw-semibold mb-3 d-flex align-items-center">
          <i class="fa-solid fa-clock-rotate-left text-primary me-2"></i>
          Processamentos Relacionados
        </h4>

        <% logs_cliente = LogProcessamento.where(cliente_id: @cliente.id).order(created_at: :desc) %>

        <% if logs_cliente.blank? %>
          <p class="text-muted">Nenhum processamento relacionado a este cliente.</p>
        <% else %>

          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>ID</th>
                <th>Status</th>
                <th>Remetente</th>
                <th>Produto</th>
                <th style="width: 50px;"></th>
              </tr>
            </thead>

            <tbody>
              <% logs_cliente.each do |log| %>
                <tr>
                  <td><%= log.id %></td>

                  <td>
                    <% if log.status == "sucesso" %>
                      <span class="badge bg-success">
                        <i class="fa-solid fa-check me-1"></i> Sucesso
                      </span>
                    <% else %>
                      <span class="badge bg-danger">
                        <i class="fa-solid fa-triangle-exclamation me-1"></i> Falha
                      </span>
                    <% end %>
                  </td>

                  <td>
                    <%= log.remetente %>
                  </td>
                  <td>
                  <%= log.produto %>
                </td>

                  <td class="text-end">
                    <%= link_to logs_processamento_path(log),
                        class: "btn btn-outline-info btn-sm p-1" do %>
                      <i class="fa-solid fa-eye"></i>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>

        <% end %>

      </div>
    </div>
  </div>
</div>
